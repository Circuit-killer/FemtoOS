<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>FemtoOS: TtaskSave Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FemtoOS
   &#160;<span id="projectnumber">0.922</span>
   </div>
   <div id="projectbrief">a very concise portable real time - preemptive operating system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&#160;Structure&#160;Index</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('struct_ttask_save.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle">
<div class="title">TtaskSave Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="femtoos__types_8h_source.html">femtoos_types.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a54ea05e0e4c7c1b0146d30fcbf7ae1e4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a54ea05e0e4c7c1b0146d30fcbf7ae1e4"></a>
Tuint08&#160;</td><td class="memItemRight" valign="bottom"><b>r31</b></td></tr>
<tr class="separator:a54ea05e0e4c7c1b0146d30fcbf7ae1e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ebaef46f74af2534781b41bc2d77dc0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2ebaef46f74af2534781b41bc2d77dc0"></a>
Tuint08&#160;</td><td class="memItemRight" valign="bottom"><b>r30</b></td></tr>
<tr class="separator:a2ebaef46f74af2534781b41bc2d77dc0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abfb35c9c2b6dc1d49d32d64bcb20a39e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abfb35c9c2b6dc1d49d32d64bcb20a39e"></a>
Tuint08&#160;</td><td class="memItemRight" valign="bottom"><b>uiRegisterUse</b></td></tr>
<tr class="separator:abfb35c9c2b6dc1d49d32d64bcb20a39e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aec8e6720833c7c112cecb3cc05fbe390"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aec8e6720833c7c112cecb3cc05fbe390"></a>
Taddress&#160;</td><td class="memItemRight" valign="bottom"><b>pcStackOffset</b></td></tr>
<tr class="separator:aec8e6720833c7c112cecb3cc05fbe390"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13b1aaff58a8b3a0ae39208c79ac7a83"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a13b1aaff58a8b3a0ae39208c79ac7a83"></a>
Taddress&#160;</td><td class="memItemRight" valign="bottom"><b>pcStackLevel</b></td></tr>
<tr class="separator:a13b1aaff58a8b3a0ae39208c79ac7a83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="struct_ttask_save.html">TtaskSave</a> is the structure which holds the "background" variables. These are the variables which are kept while a task is running. In fact, it is a way to communicate information from portRestoreContext to portSaveContext. Also it is used to save some registers temporarily during port(Save/Restore)Context. We have two versions depending on the direction of stack growth. Note that, since some of these variables must be retained until the OS has restarted, some buffer variables are needed. These keep a save distance between the variables needed and the building OS stack. Also, if we have no checking switched on, we can use a shorter version of the <a class="el" href="struct_ttask_save.html">TtaskSave</a>. The number of buffer variables is 4 at a minimum (2 addresses, namely a call to privInitOs() and a possible subsequent call to tcbCurrent(). It is assumed that those functions do not push more variables on the stack. This must be checked. In case we have no checking, only one address is pushed so we need only 2 buffer variables (one address). Please note the the order of the variables is of the utmost importance, do not change it unless you know what you are doing (and believe me, you don't yet). Just to get you going, mark these facts:</p>
<ul>
<li>The register-copy variables r31-r28 are filled at the beginning of the save context and restored at the end, because we must leave all registers untouched. The restore is thus done after the stack change to OS. Thus these variables may not be overwritten, and therefore the place to store them is as far as possible from the return address that is placed upon the OS stack.</li>
<li>uiStackTCheck, uiRegisterCheck and uiRegisterUse are used to check the result of the context switch in privInitOS. Depending on their values, the task may be terminated. So these values should survive the first method calls to and in privInitOS.</li>
<li><p class="startli">in standard operation, no registers are needed from the background variables after a return from save context. However, when checks are in place, some variables are read after the return. Those variables must be preserved upon the return. The return itself destroys at least 2 (3 for mega256) bytes, and after return there must be room for two consecutive jumps, i.e. 4 (6) bytes.</p>
<p class="startli">Note: make sure that any change in this structure is reflected in the defTaskSaveSize constant! </p>
</li>
</ul>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>MainCode/femtoos_headers/<a class="el" href="femtoos__types_8h_source.html">femtoos_types.h</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="struct_ttask_save.html">TtaskSave</a></li>
    <li class="footer">Generated on Tue Jan 14 2014 23:07:42 for FemtoOS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
